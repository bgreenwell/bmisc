y = train$count,
xtest = subset(train, select = -c(datetimem, count)),
ytest = test$count)
test
## Random forest
set.seed(101)
rfFit <- randomForest(x = subset(train, select = -c(datetime, count)),
y = train$count,
xtest = subset(train, select = -c(datetime, count)),
ytest = test$count)
rfFit
names(rfFit)
names(rfFit$test)
rfFit$test$rsq
rfFit$test[, "rsq"]
rfFit$test
names(rfFit$test)
library(ggplot2)
library(lubridate)
library(randomForest)
set.seed(1)
path <- "/home/w108bmg/Desktop/Kaggle/Bike Sharing Demand"
train <- as.tbl(read.csv(paste(path, "train.csv", sep = "/"), header = TRUE))
test <- as.tbl(read.csv(paste(path, "test.csv", sep = "/"), header = TRUE))
library(randomForest)
extractFeatures <- function(data) {
features <- c("season",
"holiday",
"workingday",
"weather",
"temp",
"atemp",
"humidity",
"windspeed",
"hour")
data$hour <- hour(ymd_hms(data$datetime))
return(data[,features])
}
trainFea <- extractFeatures(train)
testFea  <- extractFeatures(test)
submission <- data.frame(datetime=test$datetime, count=NA)
library(ggplot2)
library(lubridate)
library(randomForest)
set.seed(1)
path <- "/home/w108bmg/Desktop/Kaggle/Bike Sharing Demand"
train <- as.tbl(read.csv(paste(path, "train.csv", sep = "/"), header = TRUE))
test <- as.tbl(read.csv(paste(path, "test.csv", sep = "/"), header = TRUE))
library(randomForest)
extractFeatures <- function(data) {
features <- c("season",
"holiday",
"workingday",
"weather",
"temp",
"atemp",
"humidity",
"windspeed",
"hour")
data$hour <- hour(ymd_hms(data$datetime))
return(data[,features])
}
trainFea <- extractFeatures(train)
testFea  <- extractFeatures(test)
submission <- data.frame(datetime=test$datetime, count=NA)
unique(year(ymd_hms(test$datetime)))
for (i_year in unique(year(ymd_hms(test$datetime)))) {
for (i_month in unique(month(ymd_hms(test$datetime)))) {
cat("Year: ", i_year, "\tMonth: ", i_month, "\n")
testLocs   <- year(ymd_hms(test$datetime))==i_year & month(ymd_hms(test$datetime))==i_month
testSubset <- test[testLocs,]
trainLocs  <- ymd_hms(train$datetime) <= min(ymd_hms(testSubset$datetime))
rf <- randomForest(extractFeatures(train[trainLocs,]), train[trainLocs,"count"], ntree=100)
submission[testLocs, "count"] <- predict(rf, extractFeatures(testSubset))
}
}
#
# Click "fork" to run this script yourself and make tweaks
library(ggplot2)
library(lubridate)
library(randomForest)
set.seed(1)
path <- "/home/w108bmg/Desktop/Kaggle/Bike Sharing Demand"
train <- as.tbl(read.csv(paste(path, "train.csv", sep = "/"), header = TRUE))
test <- as.tbl(read.csv(paste(path, "test.csv", sep = "/"), header = TRUE))
library(randomForest)
extractFeatures <- function(data) {
features <- c("season",
"holiday",
"workingday",
"weather",
"temp",
"atemp",
"humidity",
"windspeed",
"hour")
data$hour <- hour(ymd_hms(data$datetime))
return(data[,features])
}
trainFea <- extractFeatures(train)
testFea  <- extractFeatures(test)
submission <- data.frame(datetime=test$datetime, count=NA)
for (i_year in unique(year(ymd_hms(test$datetime)))) {
for (i_month in unique(month(ymd_hms(test$datetime)))) {
cat("Year: ", i_year, "\tMonth: ", i_month, "\n")
testLocs   <- year(ymd_hms(test$datetime))==i_year & month(ymd_hms(test$datetime))==i_month
testSubset <- test[testLocs,]
trainLocs  <- ymd_hms(train$datetime) <= min(ymd_hms(testSubset$datetime))
rf <- randomForest(extractFeatures(train[trainLocs,]), train[trainLocs,"count"], ntree=100)
submission[testLocs, "count"] <- predict(rf, extractFeatures(testSubset))
}
}
testLocs
1==1 &
2 == 2
# Train a model across all the training data and plot the variable importance
rf <- randomForest(extractFeatures(train), train$count, ntree=100, importance=TRUE)
imp <- importance(rf, type=1)
featureImportance <- data.frame(Feature=row.names(imp), Importance=imp[,1])
p <- ggplot(featureImportance, aes(x=reorder(Feature, Importance), y=Importance)) +
geom_bar(stat="identity", fill="#53cfff") +
coord_flip() +
theme_light(base_size=20) +
xlab("Importance") +
ylab("") +
ggtitle("Random Forest Feature Importance\n") +
theme(plot.title=element_text(size=18))
p
rf
?importance
# Plot random forest feature importance
p <- ggplot(feature_importance,
aes(x = reorder(feature, importance), y = importance)) +
geom_bar(stat = "identity", fill = "#53cfff") +
coord_flip() +
theme_light(base_size = 20) +
xlab("Importance") +
ylab("") +
ggtitle("Random Forest Feature Importance\n") +
theme(plot.title = element_text(size = 18))
# Train a model across all the training data and plot the variable importance
rf <- randomForest(x = extractFeatures(train),
y = train$count,
xtest = extractFeatures(test),
ytest = test$count,
ntree = 100, importance = TRUE)
# Extract feature importance scores
imp <- importance(rf, type = 1)
feature_importance <- data.frame(feature = row.names(imp),
importance = imp[, 1])
# Plot random forest feature importance scores
p <- ggplot(feature_importance,
aes(x = reorder(feature, importance), y = importance)) +
geom_bar(stat = "identity", fill = "#53cfff") +
coord_flip() +
theme_light(base_size = 20) +
xlab("Importance") +
ylab("") +
ggtitle("Random Forest Feature Importance\n") +
theme(plot.title = element_text(size = 18))
p
rf
rf$test
test$count
plot(rf)
# Train a model across all the training data and plot the variable importance
rf <- randomForest(x = extractFeatures(train), y = train$count, ntree = 500,
importance = TRUE)
plot(rf)
rf
# Plot feature importance scores
p <- ggplot(feature_importance,
aes(x = reorder(feature, importance), y = importance)) +
geom_bar(stat = "identity", fill = "#53cfff") +
coord_flip() +
theme_light(base_size = 20) +
xlab("Importance") +
ylab("") +
ggtitle("Random Forest Feature Importance\n") +
theme(plot.title = element_text(size = 18))
p
p <- ggplot(feature_importance,
aes(x = reorder(feature, importance), y = importance)) +
geom_bar(stat = "identity", fill = "#53cfff") +
theme_light(base_size = 20) +
xlab("Importance") +
ylab("") +
coord_flip() +
ggtitle("Random Forest Feature Importance\n") +
theme(plot.title = element_text(size = 18))
p
# Plot feature importance scores
p <- ggplot(feature_importance,
aes(x = reorder(feature, importance), y = importance)) +
geom_bar(stat = "identity", fill = "#53cfff") +
coord_flip() +
theme_light(base_size = 20) +
ylab("Importance") +
xlab("") +
ggtitle("Random Forest Feature Importance\n") +
theme(plot.title = element_text(size = 18))
p
test
head(train$hour)
unique(year(ymd_hms(test$datetime)))
unique(month(ymd_hms(test$datetime)))
testLocs
testSubset <- test[testLocs, ]
trainLocs  <- ymd_hms(train$datetime) <= min(ymd_hms(testSubset$datetime))
rf <- randomForest(x = extractFeatures(train[trainLocs, ]),
y = train[trainLocs, "count"], ntree = 100)
for (i_year in unique(year(ymd_hms(test$datetime)))) {
for (i_month in unique(month(ymd_hms(test$datetime)))) {
cat("Year: ", i_year, "\tMonth: ", i_month, "\n")
testLocs <- year(ymd_hms(test$datetime)) == i_year &
month(ymd_hms(test$datetime)) == i_month
testSubset <- test[testLocs, ]
trainLocs  <- ymd_hms(train$datetime) <= min(ymd_hms(testSubset$datetime))
rf <- randomForest(x = extractFeatures(train[trainLocs, ]),
y = train[trainLocs, "count"], ntree = 100)
submission[testLocs, "count"] <- predict(rf, extractFeatures(testSubset))
}
}
i_year
i_month
extractFeatures(train[trainLocs, ])
train[trainLocs, "count"],
train[trainLocs, "count"]
rf <- randomForest(x = extractFeatures(train[trainLocs, ]),
y = train[trainLocs, "count"], ntree = 100)
train[trainLocs, ]$count
for (i_year in unique(year(ymd_hms(test$datetime)))) {
for (i_month in unique(month(ymd_hms(test$datetime)))) {
cat("Year: ", i_year, "\tMonth: ", i_month, "\n")
testLocs <- year(ymd_hms(test$datetime)) == i_year &
month(ymd_hms(test$datetime)) == i_month
testSubset <- test[testLocs, ]
trainLocs  <- ymd_hms(train$datetime) <= min(ymd_hms(testSubset$datetime))
rf <- randomForest(x = extractFeatures(train[trainLocs, ]),
y = train[trainLocs, ]$count, ntree = 100)
submission[testLocs, "count"] <- predict(rf, extractFeatures(testSubset))
}
}
submission
submission %?% tbl_df
submission %>% tbl_df
ts.plot(submission)
ts.plot(submission$count)
ts.plot(submission$count[1:1000])
ts.plot(submission$count[1:100])
ts.plot(submission$count)
library(misc)
clip <- function(x, interval, ...) {
UseMethod("clip")
}
#' @export
clip.numeric <- function(x, ...) {
x[x < interval[1L]] <- interval[1L]
x[x > interval[2L]] <- interval[2L]
x
}
clip(rnorm(10), interval = c(0, 1))
#' @export
clip.numeric <- function(x, interval, ...) {
x[x < interval[1L]] <- interval[1L]
x[x > interval[2L]] <- interval[2L]
x
}
clip(rnorm(10), interval = c(0, 1))
#' @export
clip.matrix <- function(x, interval, ...) {
x[x < interval[1L]] <- interval[1L]
x[x > interval[2L]] <- interval[2L]
x
}
clip(matrix(rnorm(25), 5, 5), interval = c(0, 1))
a <- array(rnorm(27), c(3, 3, 3))
a
#' @export
clip.array <- function(x, interval, ...) {
x[x < interval[1L]] <- interval[1L]
x[x > interval[2L]] <- interval[2L]
x
}
clip(a, interval = c(0, 1))
a
source('~/Desktop/Dropbox/devel/misc/R/clip.R', echo=TRUE)
link <- paste("http://archive.ics.uci.edu/ml/machine-learning",
"databases/adult/adult.data", sep = "-")
census <- read.csv(link, header = FALSE)
head(census)
# Add column names
names(census) <- c("age",
"workclass",
"fnlwgt",
"education",
"education-num",
"marital-status",
"occupation",
"relationship",
"race",
"sex",
"capital-gain",
"capital-loss",
"hours-per-week",
"native-country")
# Required libraries
library(dplyr)
# Read in raw data
census <- read.csv(paste("http://archive.ics.uci.edu/ml/machine-learning",
"databases/adult/adult.data", sep = "-"),
header = FALSE) %>% tbl_df
# Add column names
names(census) <- c("age",
"workclass",
"fnlwgt",
"education",
"education-num",
"marital-status",
"occupation",
"relationship",
"race",
"sex",
"capital-gain",
"capital-loss",
"hours-per-week",
"native-country")
census
census
census[, "NA"]
census <- read.csv(paste("http://archive.ics.uci.edu/ml/machine-learning",
"databases/adult/adult.data", sep = "-"),
header = FALSE) %>% tbl_df
census
census %>% select(V12:V15)
names(census) <- c("age",
"workclass",
"fnlwgt",
"education",
"education-num",
"marital-status",
"occupation",
"relationship",
"race",
"sex",
"capital-gain",
"capital-loss",
"hours-per-week",
"native-country",
"income")
census$income
file.choose()
?write.csv
write.csv(census, file = "/home/w108bmg/Desktop/CensusIncome.csv",
row.names = FALSE)
census
dim(census)
sample(c(0, 1), prob = c(0.05,0.95))
sample(c(0, 1), size = 1, prob = c(0.05,0.95))
sample(c(0, 1), size = 1, prob = c(0.05,0.95))
sample(c(0, 1), size = 1, prob = c(0.05,0.95))
sample(c(0, 1), size = 1, prob = c(0.05,0.95))
sample(c(0, 1), size = 1, prob = c(0.05,0.95))
sample(c(0, 1), size = 1, prob = c(0.05,0.95))
sample(c(0, 1), size = 1, prob = c(0.05,0.95))
sample(c(0, 1), size = 1, prob = c(0.05,0.95))
sample(c(0, 1), size = 1, prob = c(0.05,0.95))
sample(c(0, 1), size = 1, prob = c(0.05,0.95))
sample(c(0, 1), size = 1, prob = c(0.05,0.95))
sample(c(0, 1), size = 1, prob = c(0.05,0.95))
sample(c(0, 1), size = 1, prob = c(0.05,0.95))
sample(c(0, 1), size = 1, prob = c(0.05,0.95))
sample(c(0, 1), size = 1, prob = c(0.05,0.95))
sample(c(0, 1), size = 1, prob = c(0.05,0.95))
sample(c(0, 1), size = 1, prob = c(0.05,0.95))
sample(c(0, 1), size = 1, prob = c(0.05,0.95))
sample(c(0, 1), size = 1, prob = c(0.05,0.95))
sample(c(0, 1), size = 1, prob = c(0.05,0.95))
sample(c(0, 1), size = 1, prob = c(0.05,0.95))
sample(c(0, 1), size = 1, prob = c(0.05,0.95))
sample(c(0, 1), size = 1, prob = c(0.05,0.95))
sample(c(0, 1), size = 1, prob = c(0.05,0.95))
sample(c(0, 1), size = length(x), replace = TRUE, prob = c(0.05,0.95))
sample(c(0, 1), size = 10, replace = TRUE, prob = c(0.05,0.95))
sample(c(0, 1), size = 10, replace = TRUE, prob = c(0.05,0.95))
sample(c(0, 1), size = 10, replace = TRUE, prob = c(0.05,0.95))
sample(c(0, 1), size = 10, replace = TRUE, prob = c(0.05,0.95))
sample(c(0, 1), size = 10, replace = TRUE, prob = c(0.05,0.95))
sample(c(0, 1), size = 10, replace = TRUE, prob = c(0.05,0.95))
sample(c(0, 1), size = 10, replace = TRUE, prob = c(0.05,0.95))
sample(c(0, 1), size = 10, replace = TRUE, prob = c(0.05,0.95))
sample(c(0, 1), size = 10, replace = TRUE, prob = c(0.05,0.95))
sample(c(0, 1), size = 10, replace = TRUE, prob = c(0.05,0.95))
sample(c(0, 1), size = 10, replace = TRUE, prob = c(0.05,0.95))
sample(c(0, 1), size = 10, replace = TRUE, prob = c(0.05,0.95))
sample(c(0, 1), size = 10, replace = TRUE, prob = c(0.05,0.95))
sample(c(0, 1), size = 10, replace = TRUE, prob = c(0.05,0.95))
sample(c(0, 1), size = 10, replace = TRUE, prob = c(0.05,0.95))
sample(c(0, 1), size = 10, replace = TRUE, prob = c(0.05,0.95))
sample(c(0, 1), size = 10, replace = TRUE, prob = c(0.05,0.95))
sample(c(0, 1), size = 10, replace = TRUE, prob = c(0.05,0.95))
sample(c(0, 1), size = 10, replace = TRUE, prob = c(0.05,0.95))
census
strsplit("a-b", "-")
strsplit("a-b", "-")[[1]]
paste0(strsplit("a-b", "-")[[1]])
paste0(strsplit("a-b", "-")[[1]], collapse = " ")
paste0(strsplit("afb", "-")[[1]], collapse = " ")
paste0(strsplit(c("afb", "a-b"), "-")[[1]], collapse = " ")
?strsplit
sub("-", " ", c("abc", "a-b"))
census2 <- census
# Age
set.seed(1)
id <- sample(nrow(census2), size = 100)
census2[id, "age"] <- "."
census2$age
sort(unique(census2$age))
table(unique(census2$age))
table(census2$age)
set.seed(2)
id <- sample(nrow(census2), size = 500)
census2[id, "workclass"] <- sub("-", " ", census2[id, "workclass"])
census2[id, "workclass"] <- sub("-", " ", census2[id, ]$workclass)
# Copy data
census2 <- census
# Age
set.seed(1)
id <- sample(nrow(census2), size = 100)
census2[id, "age"] <- "."
# Workclass (remove hyphens)
set.seed(2)
id <- sample(nrow(census2), size = 500)
census2[id, "workclass"] <- sub("-", " ", census2[id, ]$workclass)
# Copy data
census2 <- census
# Age
set.seed(1)
id <- sample(nrow(census2), size = 100)
census2[id, ]$age <- "."
# Workclass (remove hyphens)
set.seed(2)
id <- sample(nrow(census2), size = 500)
census2[id, ]workclass <- sub("-", " ", census2[id, ]$workclass)
census2[id, ]$workclass <- sub("-", " ", census2[id, ]$workclass)
table(census2$workclass)
id <- sample(nrow(census2), size = 500)
census2[id, ]$workclass <- sub("-", " ", census2[id, ]$workclass)
table(census2$workclass)
class(census2[id, ]$workclass)
census2[id, ]$workclass <- sub("-", " ", as.character(census2[id, ]$workclass))
table(census2$workclass)
id <- sample(nrow(census2), size = 500)
census2[id, ]$workclass <- sub("-", " ", as.character(census2[id, ]$workclass))
table(census2$workclass)
?unique
?nlevels
?uunique
?unique
unique(cars)
length(unique(cars))
?length
is.vector(cars)
is.vector(1:4)
is.vector
?is.vector
source('~/Desktop/Dropbox/devel/misc/R/nunique.R', echo=TRUE)
nunique(sample(1:10, size = 100, replace=T))
nunique(sample(1:10, size = 100, replace=T))
nunique(sample(1:10, size = 100, replace=T))
nunique(sample(1:10, size = 100, replace=T))
nunique(sample(1:10, size = 100, replace=T))
nunique(sample(1:10, size = 100, replace=T))
nunique(sample(1:10, size = 100, replace=T))
nunique(sample(1:10, size = 100, replace=T))
nunique(sample(1:10, size = 20, replace=T))
nunique(sample(1:10, size = 20, replace=T))
nunique(sample(1:10, size = 20, replace=T))
nunique(sample(1:10, size = 20, replace=T))
nunique(sample(1:10, size = 20, replace=T))
nunique(cars)
dim(cars)
duplicated(cars)
cars[duplicated(cars), ]
cars
?median
na.rm
na.omit
inrange <- function(x, lower, upper) {
ifelse(x > lower & x < upper, 1, 0)
}
inrange(runif(10, 0, 1))
inrange(runif(10), 0, 1)
inrange(runif(10), 0, 0.5)
is.numeric(1L)
inrange <- function(x, lower, upper, strict = TRUE) {
stopifnot(is.numeric(x) || is.numeric(lower) || is.numeric(upper) ||
is.logical(strict))
if (strict) {
ifelse(x > lower & x < upper, 1, 0)
} else {
ifelse(x >= lower & x <= upper, 1, 0)
}
}
inrange(rnorm(100), -3, 3)
inrange(rnorm(10000), -3, 3)
mean(inrange(rnorm(10000), -3, 3))
mean(inrange(rnorm(1e+06), -3, 3))
mean(inrange(rnorm(1e+06), -3, 3))
mean(inrange(rnorm(1e+06), -3, 3))
mean(inrange(rnorm(1e+06), -3, 3))
inrange(3, 0, 1)
